jQuery(document).ready(function(o){var s=ffuShop.translation.lang;ffuShop.translation.userInfoCheckout={ua:{first_namePlaceholder:"Ваше iм`я",last_namePlaceholder:"Ваше прізвище",emailPlaceholder:"Ваш e-mail",phonePlaceholder:"Ваш телефон"},en:{first_namePlaceholder:"Your First Name",last_namePlaceholder:"Your Last Name",emailPlaceholder:"Your E-mail",phonePlaceholder:"Your Phone"}},Vue.component("user-info-checkout",{store:ffuShop.store,data:function(){return{fields:{first_name:{type:"text",placeholder:ffuShop.translation.userInfoCheckout[s].first_namePlaceholder,required:!0,valid:!1,pattern:new RegExp("^[a-zа-я ,.'-]+$","i")},last_name:{type:"text",placeholder:ffuShop.translation.userInfoCheckout[s].last_namePlaceholder,required:!1,valid:!0},email:{type:"email",placeholder:ffuShop.translation.userInfoCheckout[s].emailPlaceholder,required:!0,valid:!1,pattern:new RegExp(/^([\w.*-]+@([\w-]+\.)+[\w-]{2,4})$/)},phone:{type:"tel",placeholder:ffuShop.translation.userInfoCheckout[s].phonePlaceholder,required:!0,valid:!1,pattern:new RegExp("\\+38\\([0-9]{3}\\)[0-9]{3}-[0-9]{2}-[0-9]{2}")}}}},computed:{fieldValues:function(){return{first_name:this.$store.state.user.first_name,last_name:this.$store.state.user.last_name,email:this.$store.state.user.email,phone:this.$store.state.user.phone}},user:function(){return this.$store.state.user}},created:this.validate,updated:this.validate,methods:{setField:function(e){var t=e.target.name,i=e.target.value;if("phone"==t){var r="+38(0",o=i;i=(i=(i=i.replace(/\D/g,"")).replace(/^(380|38|3)/,"")).substring(0,9);for(var s=0;s<i.length;s++)r+=i[s]+(1==s?")":""),r+=4==s||6==s?"-":"";o.length<r.length&&r[r.length-1].match(/\D/)&&(r=r.substring(0,r.length-1)),i=r,e.target.value=r}this.$store.commit("setUserInfo",[t,i]),this.validate()},filedValid:function(e){var t=this.fields[e],i=this.fieldValues[e],r=!0;return t.required&&!i&&(r=!1),t.pattern&&!t.pattern.test(i)&&(r=!1),r},validate:function(){var e=!0;for(field in this.fields)e=e&&this.filedValid(field);this.$store.commit("setUserInfo",["valid",e])}},template:'<form action="" class="uk-grid-small uk-child-width-1-2@s uk-child-width-1-4@l" uk-grid>        <div v-for="(field, name) in fields" :key="name">            <input  :type="field.type"                    :name="name"                    class="uk-input"                    :class="{\'uk-form-danger\': ! filedValid(name)}"                    :disabled="user.registered"                    :placeholder="field.placeholder + (field.required ? \' *\' : \'\')"                    :value="fieldValues[name]"                    @input="setField">        </div>    </form>'});s=ffuShop.translation.lang;var a={ua:{title:"Кур'єрська доставка по м. Києву",placeholderStr:"вул./пров./пл.",placeholderBld:"дім",placeholderApt:"кв"},en:{title:"Courier Delivery in Kiev",placeholderStr:"str./sq.",placeholderBld:"bld.",placeholderApt:"apt."}};ffuShop.store.commit("createDeliveryProvider",["courier",{component:"courier-delivery",title:a[s].title,cost:100,options:{addressStr:null,addressBld:null,addressApt:null,details:[a[s].title]},valid:!1}]),Vue.component("courier-delivery",{props:{isActive:{type:Boolean,required:!0}},store:ffuShop.store,data:function(){return{providerName:"courier",fields:{addressStr:{wrapClass:"uk-width-expand@s",placeholder:a[s].placeholderStr,required:!0,valid:!1},addressBld:{wrapClass:"uk-width-1-2 uk-width-small@s",placeholder:a[s].placeholderBld,required:!0,valid:!1},addressApt:{wrapClass:"uk-width-1-2 uk-width-small@s",placeholder:a[s].placeholderApt,required:!0,valid:!1}}}},computed:{isValid:function(){var e=!0;for(field in this.fields)this.fields[field].required&&!this.fieldValues[field]?(e=!1,Vue.set(this.fields[field],"valid",!1)):Vue.set(this.fields[field],"valid",!0);return e},fieldValues:function(){return this.$store.state.deliveryProviders[this.providerName].options}},created:this.validate,updated:this.validate,methods:{errorClass:function(e){return this.isActive?e.valid?"":"uk-form-danger":""},deliveryDetails:function(){var e="";for(i in this.fields)e+=e.length?", ":"",e+=this.fields[i].placeholder+" "+this.fieldValues[i];return e},checkField:function(e){var t=e.target.name,i=e.target.value;this.$store.commit("setDeliveryProviderField",[this.providerName,t,i]);var r=[a[s].title];r.push(this.deliveryDetails()),this.$store.commit("setDeliveryProviderField",[this.providerName,"details",r]),this.validate()},validate:function(){this.$store.commit("setDeliveryProviderValid",[this.providerName,this.isValid])}},template:'<form action="" uk-grid>                    <div v-for="(field, fieldName) in fields"                         :key="fieldName"                         :class="field.wrapClass">                         <input type="text" class="uk-input"                                :class="errorClass(field)"                                :value="fieldValues[fieldName]"                                :name="fieldName"                                :placeholder="field.placeholder"                                @input="checkField">                    </div>                </form>'});s=ffuShop.translation.lang;var n={ua:{title:"Нова Пошта",buttonText:"Оберіть номер відділення",detailsPrefix:"Україна, м. ",noCityErr:"Оберiть мicто зi списку мiст"},en:{title:"Nova Poshta",buttonText:"Choose Department",detailsPrefix:"Ukraine, м. ",noCityErr:"Choose city from list"}};ffuShop.store.commit("createDeliveryProvider",["new-post",{component:"new-post-delivery",title:n[s].title,cost:75,options:{city:null,department:null,warehouse:null,details:[n[s].title]},valid:!1}]),jQuery(document).ready(function(e){var t=e('<script async="" defer="" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPhm7Q29X5ldwjLtA7IMYHU_0xATiWK3A&amp;language=ua">'),i=e('<link rel="stylesheet" href="https://apimgmtstorelinmtekiynqw.blob.core.windows.net/content/MediaLibrary/Widget/Map/styles/map.css">');e("head").append(i),e("body").append(t)}),Vue.component("new-post-delivery",{props:{isActive:{type:Boolean,required:!0}},data:function(){return{providerName:"new-post",fields:{city:{required:!0},department:{required:!0},warehouse:{required:!0}},buttonText:n[s].buttonText}},computed:{deliveryData:function(){return this.$store.state.deliveryProviders[this.providerName].options},department:function(){return this.deliveryData.city&&this.deliveryData.department?this.deliveryData.city+", "+this.deliveryData.department:""},isValid:function(){var e=!0;for(field in this.fields)this.fields[field].required&&!this.deliveryData[field]&&(e=!1);return e}},mounted:function(){var e=o('<script type="text/javascript" id="map" charset="utf-8" data-lang="ua" apiKey="597859b7955dc05b6595d86bd6fc96fc" data-town="undefined" data-town-name="undefined" data-town-id="undefined" src="https://apimgmtstorelinmtekiynqw.blob.core.windows.net/content/MediaLibrary/Widget/Map/dist/map.min.js">');function t(){console.log("get details"),o("#npw-map-wrapper").on("click",function e(t){if("npw-map-close-button"!=t.target.id){var i=o("#npw-map-state-details .npw-details-title"),r=o("#npw-cities").val();""!=i.text()&&null!==r?(o.ajax({type:ffuShop.routes.cart.getNPDeliveryPrice.req,url:ffuShop.routes.cart.getNPDeliveryPrice.url,dataType:"json",data:{city:r,department:i.text(),productsQuantity:ffuShop.checkout.cartTotal.quantity,productsCost:ffuShop.checkout.cartTotal.products},success:function(e){ffuShop.store.commit("setDeliveryProviderCost",["new-post",e.price]),ffuShop.store.commit("setDeliveryProviderField",["new-post","warehouse",e.warehouse]),ffuShop.store.commit("setDeliveryProviderField",["new-post","details",[n[s].detailsPrefix+r,i.next().text()]])}}),ffuShop.store.commit("setDeliveryProviderField",["new-post","city",r]),ffuShop.store.commit("setDeliveryProviderField",["new-post","department",i.text()]),ffuShop.store.commit("setDeliveryProviderValid",["new-post",!0]),o("#npw-map-wrapper").off("click",e),o("#npw-map-close-button").click()):(ffuShop.store.commit("setDeliveryProviderField",["new-post","city",""]),ffuShop.store.commit("setDeliveryProviderField",["new-post","department",""]),ffuShop.store.commit("setDeliveryProviderField",["new-post","details",[]]),ffuShop.store.commit("setDeliveryProviderValid",["new-post",!1]),null==r&&UIkit.notification({message:n[s].noCityErr,status:"danger"}))}else o("#npw-map-wrapper").off("click",e)})}o("body").append(e),o("#fsCheckout").on("click","#npw-map-open-button",t),o("#fsCheckout").on("click","#npw-map-close-button",function(){o("#npw-map-wrapper").off("click",setDetails),o("#fsCheckout").off("click","#npw-map-open-button",t)})},beforeDestroy:function(){NPWidgetMap=null,o("#map, #npw-map-wrapper").remove()},created:this.validate,updated:this.validate,methods:{errorClass:function(){return this.isActive?this.isValid?"uk-button-default":"uk-button-danger":"uk-button-default"},validate:function(){this.$store.commit("setDeliveryProviderValid",[this.providerName,this.isValid()])}},template:'<div id="np-map">                    <button type="button" id="npw-map-open-button" class="uk-button" :class="errorClass()">{{ buttonText }}</button>                    <br class="uk-hidden@s">                    {{ department }}                </div>'});s=ffuShop.translation.lang;var e={ua:{title:"Самовивіз"},en:{title:"Self-delivery"}};ffuShop.store.commit("createDeliveryProvider",["self",{component:"self-delivery",title:e[s].title,cost:0,options:{details:[e[s].title]},valid:!0}]),Vue.component("self-delivery",{props:{isActive:{type:Boolean,required:!0}},data:function(){return{providerName:"self"}},computed:{isValid:function(){return!0}},created:this.validate,updated:this.validate,methods:{validate:function(){this.$store.commit("setDeliveryProviderValid",[this.providerName,this.isValid])}},template:"<div></div>"});s=ffuShop.translation.lang;ffuShop.store.commit("createPaymentProvider",["credit-card",{title:{ua:{title:"Сплатити онлайн (Visa, Mastercard)"},en:{title:"Pay online (Visa, Mastercard)"}}[s].title,cost:0,options:{redirect:"https://www.liqpay.ua/"}}]);s=ffuShop.translation.lang;ffuShop.store.commit("createPaymentProvider",["cash-on-delivery",{title:{ua:{title:"Наложений платіж"},en:{title:"Cash On Delivery"}}[s].title,cost:34,options:{redirect:"/thank-you.html"}}]),ffuShop.checkout=new Vue({el:"#fsCheckout",store:ffuShop.store,data:{page:0,scrollEl:UIkit.scroll("#fsCheckout",{offset:60,duration:300}),active:!0},computed:{products:function(){return this.$store.getters.products},user:function(){return this.$store.state.user},delivery:function(){return this.$store.getters.delivery},deliveryDetails:function(){return this.$store.getters.deliveryDetails},payment:function(){return this.$store.getters.payment},isDeliveryValid:function(){return this.$store.getters.deliveryValid},cartTotal:function(){var e,t=0,i=0;for(p in this.products)this.products[p].qty&&(t++,i+=this.products[p].qty*this.products[p].discountPrice);return e=i,0<this.page&&(i+=this.$store.getters.deliveryCost),1<this.page&&(i+=this.payment.providers[this.payment.active].cost),{quantity:t,summ:Math.round(i),products:Math.round(e)}}},methods:{transBeforeEnter:function(e){e.style.display="none"},transEnter:function(e,t){var i=this;o(e).delay(300).slideDown(function(){UIkit.update(event="update"),e.offsetHeight>window.innerHeight&&i.scrollEl.scrollTo(i.$el),t()})},transLeave:function(e,t){o(e).slideUp(t)},quantityChange:function(e,t,i){if(e==t&&1==t)this.removeProduct(i);else{this.active=!1;var r=[i,t],o=this;this.$store.dispatch("setProductQuantity",r).then(function(){o.products[i].qty=t,o.products[i].subtotal=t*o.products[i].price}).catch(function(e){UIkit.notification({status:"warning",message:e})}).finally(function(){o.active=!0})}},removeProduct:function(e){var t=ffuShop.translation[ffuShop.translation.lang].removeCart.confirm+this.products[e].name+"?",i=this;UIkit.modal.confirm(t,{labels:{ok:ffuShop.translation[ffuShop.translation.lang].removeCart.ok,cancel:ffuShop.translation[ffuShop.translation.lang].removeCart.cancel}}).then(function(){i.active=!1,i.$store.dispatch("removeProduct",e).finally(function(){i.active=!0})}).catch(function(e){"object"==typeof e&&console.log(e)})},setPage:function(e,t){!t&&e<this.page?this.page=e:t&&(this.page=e)},navClass:function(e){return e<=this.page?"uk-active":null},setDeliveryProvider:function(e){this.$store.commit("setDeliveryProvider",e)},setPaymentProvider:function(e){this.$store.commit("setPaymentProvider",e)},registerUser:function(){var e=o.extend({},this.user),t=this.$store.state;for(name in this.active=!1,e.deliveryProviders={},t.deliveryProviders){var i=t.deliveryProviders[name];e.deliveryProviders[name]={options:i.options,valid:i.valid}}var r=this;return new Promise(function(t,i){o.ajax({url:ffuShop.routes.cart.registerUser.url,type:ffuShop.routes.cart.registerUser.req,data:e,dataType:"json",success:function(e){o.isEmptyObject(e.errors)&&e.is_active?t():i(e.errors)},error:function(e,t){ffuShop.helpers.errorReject(i,e,t)}})}).finally(function(){r.active=!0})},validateDelivery:function(){var e=!0,t=this,i=ffuShop.translation.lang;function r(){if(t.isDeliveryValid||(UIkit.notification({message:ffuShop.translation[i].checkout.noDelivery,status:"danger"}),e=!1),!e)return o(".fs-transition-holder .fs-checkout-options").removeClass("fs-hide-danger"),void setTimeout(function(){o(".fs-transition-holder .fs-checkout-options").addClass("fs-hide-danger"),t.active=!0},2e3,t);t.setPage(t.page+1,!0),t.active=!0}this.active=!1,this.user.valid?this.user.registered?r():this.registerUser().then(function(){ffuShop.store.commit("setUserInfo",["registered",!0]),r()}).catch(ffuShop.helpers.errorHandler):(UIkit.notification({message:ffuShop.translation[i].checkout.noUser,status:"danger"}),e=!1)},validatePayment:function(){this.setPage(this.page+1,!0)},confirmOrder:function(){var e=this.$store.state.order,t=this;e.delivery.details=this.$store.getters.deliveryDetails,e.delivery.warehouse=this.$store.getters.deliveryDetailsWarehouse,e.delivery.cost=this.$store.getters.deliveryCost,e.user=this.$store.state.user,e.products=this.$store.state.products,o.ajax({type:ffuShop.routes.checkout.confirm.req,url:ffuShop.routes.checkout.confirm.url,data:e,dataType:"json",success:function(e){switch(e.action){case"redirect":location.href=e.url;break;case"pay":o(e.form).appendTo(o("body")).submit();break;case"quantity":UIkit.notification({status:"warning",message:e.message}),t.$store.dispatch("getProducts")}},error:function(e,t){console.log(t,e)}})}}})});
//# sourceMappingURL=checkout.js.map
